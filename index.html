<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) ‚Ä¢ ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î + ‡∏´‡∏°‡∏ß‡∏î + Auto-code</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@zxing/library@0.20.0"></script>
  <style>body{font-family:'Noto Sans Thai',sans-serif;padding:1rem;max-width:700px;margin:auto;background:#f9fafb;color:#111}
    .card{background:#fff;padding:1rem;margin:.5rem 0;border:1px solid #ddd;border-radius:.75rem;box-shadow:0 1px 2px rgba(0,0,0,.05)}
    .grid{display:grid;gap:.5rem;grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
    label{font-size:.9rem;display:flex;flex-direction:column;gap:.25rem}
    input,select{padding:.35rem .5rem;font-size:1rem;border:1px solid #ccc;border-radius:.5rem}
    button{padding:.45rem .75rem;border:none;border-radius:.5rem;cursor:pointer}
    .btn-primary{background:#2563eb;color:#fff}
    .btn-secondary{background:#6b7280;color:#fff}
    .btn-ghost{background:none;color:#111;border:1px solid #ccc}
    .toolbar{display:flex;justify-content:space-between;align-items:center;margin:.5rem 0}
    .list .item{padding:.5rem;border-bottom:1px solid #eee}
    .chips{display:flex;gap:.25rem;flex-wrap:wrap;margin-top:.25rem}
    .chip{font-size:.75rem;padding:.15rem .45rem;border-radius:.6rem;border:1px solid #ddd;background:#e5e7eb;color:#111}
  </style>
</head>
<body>
  <h1>üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
  <section id="tab-products" class="tab active">
    <form id="productForm" class="card">
      <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
      <div class="grid">
        <label>‡∏£‡∏´‡∏±‡∏™/‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î
          <input type="text" id="pCode" placeholder="‡πÄ‡∏ä‡πà‡∏ô QR001" />
        </label>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          <input type="text" id="pName" placeholder="‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏° 500ml" />
        </label>
        <label>‡∏´‡∏°‡∏ß‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ,)
          <input type="text" id="pCats" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°" />
        </label>
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢
          <input type="text" id="pUnit" placeholder="‡∏Ç‡∏ß‡∏î, ‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡∏ä‡∏¥‡πâ‡∏ô" />
        </label>
        <label>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
          <input type="number" id="pMin" inputmode="numeric" min="0" value="0" />
        </label>
        <label>‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          <input type="text" id="pLocation" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏±‡πâ‡∏ô A1" />
        </label>
      </div>
      <div class="row wrap" style="margin-top:.5rem">
        <button type="submit" class="btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
        <button type="button" id="resetProductForm" class="btn-ghost">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
      </div>
    </form>

    <div class="card">
      <h3>‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏´‡∏±‡∏™ (Auto-code)</h3>
      <div class="grid">
        <label>Prefix
          <input type="text" id="batchPrefix" placeholder="QR" />
        </label>
        <label>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏Ç
          <input type="number" id="batchStart" value="1" min="1" />
        </label>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
          <input type="number" id="batchCount" value="1" min="1" max="1000" />
        </label>
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å (padding)
          <input type="number" id="batchPad" value="3" min="1" max="10" />
        </label>
        <label>Template ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
          <input type="text" id="batchNameTpl" placeholder="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ {code}" />
        </label>
        <label>‡∏´‡∏°‡∏ß‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ,)
          <input type="text" id="batchCats" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°, ‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà" />
        </label>
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢
          <input type="text" id="batchUnit" placeholder="‡∏ä‡∏¥‡πâ‡∏ô / ‡∏Å‡∏•‡πà‡∏≠‡∏á" />
        </label>
        <label>‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö
          <input type="text" id="batchLocation" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏±‡πâ‡∏ô A1" />
        </label>
        <label>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
          <input type="number" id="batchMin" value="0" min="0" />
        </label>
      </div>
      <button type="button" id="batchAddBtn" class="btn-secondary">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</button>
      <p class="muted">* ‡πÄ‡∏ä‡πà‡∏ô Prefix QR, Start=1, Count=100, Pad=3 ‚Üí QR001 ‡∏ñ‡∏∂‡∏á QR100</p>
    </div>

    <div class="toolbar">
      <input type="search" id="searchProduct" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™/‡∏´‡∏°‡∏ß‡∏î..." />
      <span id="productCount"></span>
    </div>
    <div class="list" id="productList"></div>
  </section>

  <script>
    const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
    const state={products:[],txns:[]};
    function save(){localStorage.setItem('wh-lite',JSON.stringify(state));}
    function load(){const d=localStorage.getItem('wh-lite');if(d){Object.assign(state,JSON.parse(d));}}
    function toCats(str){return (str||'').split(',').map(s=>s.trim()).filter(Boolean);}

    const pForm=$('#productForm'),pCode=$('#pCode'),pName=$('#pName'),pCats=$('#pCats'),pUnit=$('#pUnit'),pMin=$('#pMin'),pLocation=$('#pLocation');
    const batchPrefix=$('#batchPrefix'),batchStart=$('#batchStart'),batchCount=$('#batchCount'),batchPad=$('#batchPad'),batchNameTpl=$('#batchNameTpl'),batchCats=$('#batchCats'),batchUnit=$('#batchUnit'),batchLocation=$('#batchLocation'),batchMin=$('#batchMin');

    pForm.addEventListener('submit',e=>{
      e.preventDefault();
      const code=pCode.value.trim(); if(!code){alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™');return;}
      const ex=state.products.find(p=>p.code===code);
      if(ex){ex.name=pName.value;ex.unit=pUnit.value;ex.min=Number(pMin.value||0);ex.location=pLocation.value;ex.cats=toCats(pCats.value);}else{
        state.products.push({id:crypto.randomUUID(),code,name:pName.value,unit:pUnit.value,min:Number(pMin.value||0),location:pLocation.value,cats:toCats(pCats.value)});
      }
      save();renderProducts();pForm.reset();
    });

    batchAddBtn.addEventListener('click',()=>{
      const prefix=batchPrefix.value.trim(); let start=Number(batchStart.value||1); let count=Number(batchCount.value||0); const pad=Number(batchPad.value||3);
      const cats=toCats(batchCats.value); const unit=batchUnit.value; const loc=batchLocation.value; const min=Number(batchMin.value||0);
      if(!prefix||count<=0){alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');return;}
      let created=0;
      for(let i=0;i<count;i++){
        const num=String(start+i).padStart(pad,'0'); const code=prefix+num;
        if(state.products.find(p=>p.code===code)) continue;
        const name=batchNameTpl.value?batchNameTpl.value.replaceAll('{code}',code).replaceAll('{num}',num):`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${code}`;
        state.products.push({id:crypto.randomUUID(),code,name,unit,min,location:loc,cats});
        created++;
      }
      save();renderProducts();alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà '+created+' ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß');
    });

    function renderProducts(){
      const q=$('#searchProduct').value.toLowerCase();
      const list=state.products.filter(p=>!q||p.name.toLowerCase().includes(q)||p.code.toLowerCase().includes(q)||(p.cats||[]).some(c=>c.toLowerCase().includes(q)));
      $('#productCount').textContent=`${list.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      $('#productList').innerHTML='';
      for(const p of list){
        const chips=(p.cats||[]).map(c=>`<span class=\"chip\">${c}</span>`).join('');
        $('#productList').innerHTML+=`<div class=item><strong>${p.name}</strong> <span class=muted>(${p.code})</span><div>${chips}</div><div class=muted>${p.unit||''} ‚Ä¢ ${p.location||''}</div></div>`;
      }
    }

    load();renderProducts();
  </script>
</body>
</html>
